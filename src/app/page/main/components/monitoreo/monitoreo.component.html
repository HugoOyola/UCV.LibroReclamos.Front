<!-- Header del Monitoreo -->
<div class="bg-[#243659] shadow-lg p-6 md:p-6">
  <div class="flex flex-col items-start justify-between gap-6 md:flex-row md:items-center">
    <!-- Título y descripción -->
    <div class="flex items-center gap-2">
      <div class="items-center justify-center hidden sm:flex">
        <span class="text-4xl text-white material-symbols-outlined">chart_data</span>
      </div>
      <div class="leading-none">
        <h1 class="text-xl font-bold text-white">
          MONITOREO DE RECLAMACIONES
        </h1>
        <p class="mt-1 text-sm text-gray-400">
          Busque y supervise reclamaciones con filtros avanzados y búsqueda inteligente.
        </p>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="flex flex-wrap justify-start w-full gap-3 md:w-auto md:justify-end">
      <div class="flex gap-4">
        <p-button icon="pi pi-refresh" label="Actualizar" severity="secondary" size="small"
          (onClick)="actualizarDatos()" />
        <p-button icon="pi pi-home" label="Volver al Inicio" severity="danger" size="small"
          (onClick)="volverAlInicio()" />
      </div>
    </div>
  </div>
</div>

<div class="w-full px-4 pt-6 pb-10 mx-auto">
  <!-- Tarjetas de Estadísticas (solo se muestran cuando hay búsqueda realizada) -->
  <div *ngIf="showResults && searchPerformed" class="grid grid-cols-1 gap-4 mb-6 sm:grid-cols-2 lg:grid-cols-4">
    <!-- Total Reclamaciones -->
    <div
      class="bg-white rounded-lg shadow-sm p-6 border-solid border border-gray-100 cursor-pointer transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:border-blue-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="mb-1 text-sm text-gray-500">Total Reclamaciones</p>
          <h3 class="text-2xl font-bold text-gray-900">{{ stats.total }}</h3>
        </div>
        <div class="flex items-center justify-center w-12 h-12 bg-blue-100 rounded-xl">
          <i class="text-xl text-blue-600 pi pi-file-edit"></i>
        </div>
      </div>
    </div>

    <!-- A Tiempo -->
    <div
      class="bg-white rounded-lg shadow-sm p-6 border-solid border border-gray-100 cursor-pointer transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:border-green-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="mb-1 text-sm text-gray-500">A Tiempo</p>
          <h3 class="text-2xl font-bold text-green-600">{{ stats.aTiempo }}</h3>
        </div>
        <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-xl">
          <i class="text-xl text-green-600 pi pi-check-circle"></i>
        </div>
      </div>
    </div>

    <!-- Por Vencer -->
    <div
      class="bg-white rounded-lg shadow-sm p-6 border-solid border border-gray-100 cursor-pointer transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:border-yellow-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="mb-1 text-sm text-gray-500">Por Vencer</p>
          <h3 class="text-2xl font-bold text-yellow-600">{{ stats.porVencer }}</h3>
        </div>
        <div class="flex items-center justify-center w-12 h-12 bg-yellow-100 rounded-xl">
          <i class="text-xl text-yellow-600 pi pi-clock"></i>
        </div>
      </div>
    </div>

    <!-- Vencidos -->
    <div
      class="bg-white rounded-lg shadow-sm p-6 border-solid border border-gray-100 cursor-pointer transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:border-red-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="mb-1 text-sm text-gray-500">Vencidos</p>
          <h3 class="text-2xl font-bold text-red-600">{{ stats.vencidos }}</h3>
        </div>
        <div class="flex items-center justify-center w-12 h-12 bg-red-100 rounded-xl">
          <i class="text-xl text-red-600 pi pi-exclamation-triangle"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Centro de Búsqueda - Solo se muestra cuando NO hay resultados -->
  <div *ngIf="!showResults" class="mt-6 bg-white border border-gray-200 border-solid rounded-lg shadow-sm">
    <!-- Header del Centro de Búsqueda -->
    <div class="text-white rounded-t-lg bg-[#243659]">
      <div class="items-center gap-4 p-4">
        <div class="flex items-center gap-1 uppercase">
          <i class="text-lg pi pi-search"></i>
          <h2 class="text-lg font-semibold">Centro de Búsqueda Inteligente</h2>
        </div>
        <p class="text-sm text-gray-400">
          Encuentre reclamaciones con filtros avanzados o búsqueda rápida
        </p>
      </div>
    </div>

    <!-- Tabs -->
    <div class="border-0 border-b border-gray-200 border-solid">
      <nav class="flex w-full mb-px">
        <button type="button" (click)="setActiveTab('advanced')"
          [class]="activeTab === 'advanced' ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
          class="flex items-center justify-center flex-1 gap-2 px-6 py-3 font-medium transition-colors border-0 border-b-2 border-solid text-md">
          <i class="text-lg pi pi-sliders-h"></i>
          Búsqueda Avanzada
        </button>
        <button type="button" (click)="setActiveTab('quick')"
          [class]="activeTab === 'quick' ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
          class="flex items-center justify-center flex-1 gap-2 px-6 py-3 font-medium transition-colors border-0 border-b-2 border-solid text-md">
          <i class="text-lg pi pi-bolt"></i>
          Búsqueda Rápida
        </button>
      </nav>
    </div>

    <!-- Contenido de Tabs -->
    <div class="p-6">
      <!-- Búsqueda Avanzada -->
      <div *ngIf="activeTab === 'advanced'">
        <form [formGroup]="searchForm">
          <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
            <!-- Filtros Básicos -->
            <div class="p-6 space-y-4 border border-gray-200 border-solid rounded-lg shadow-sm">
              <div class="flex items-center gap-2 mb-4">
                <div class="flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg">
                  <i class="text-lg text-blue-600 pi pi-filter"></i>
                </div>
                <h3 class="text-lg font-semibold text-blue-700 uppercase">Filtros Básicos</h3>
              </div>

              <!-- Campus Universitario -->
              <div>
                <label class="block mb-2 text-sm font-medium text-gray-700">Campus o Filial</label>
                <p-select [options]="campusOptions" formControlName="campus" placeholder="Seleccionar Campus"
                  class="w-full" size="small"></p-select>
              </div>

              <!-- Período de Tiempo -->
              <div>
                <label class="block mb-2 text-sm font-medium text-gray-700">Fecha de Inicio y Fin</label>
                <p-datepicker formControlName="fechaRango" placeholder="Seleccionar rango de fechas" class="w-full"
                  size="small" dateFormat="dd/mm/yy" selectionMode="range"></p-datepicker>
              </div>
            </div>

            <!-- Tipo de Reclamación -->
            <div class="p-6 space-y-4 border border-gray-200 border-solid rounded-lg shadow-sm">
              <div class="flex items-center gap-2 mb-4">
                <div class="flex items-center justify-center w-8 h-8 bg-red-100 rounded-lg">
                  <i class="text-lg text-red-600 pi pi-file-edit"></i>
                </div>
                <h3 class="text-lg font-semibold text-red-700 uppercase">Tipo de Reclamo</h3>
              </div>

              <div class="space-y-3">
                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="tipoTodos" inputId="tipo_todos"
                    (onChange)="onTipoReclamacionChange('todos')"></p-checkbox>
                  <label for="tipo_todos" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    TODOS LOS TIPOS
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="tipoReclamo" inputId="tipo_reclamo"
                    (onChange)="onTipoReclamacionChange('reclamo')"></p-checkbox>
                  <label for="tipo_reclamo" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    RECLAMO
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="tipoQueja" inputId="tipo_queja"
                    (onChange)="onTipoReclamacionChange('queja')"></p-checkbox>
                  <label for="tipo_queja" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    QUEJA
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="tipoConsulta" inputId="tipo_consulta"
                    (onChange)="onTipoReclamacionChange('consulta')"></p-checkbox>
                  <label for="tipo_consulta" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    CONSULTA / SUGERENCIA
                  </label>
                </div>
              </div>
            </div>

            <!-- Estados de Proceso -->
            <div class="p-6 space-y-4 border border-gray-200 border-solid rounded-lg shadow-sm">
              <div class="flex items-center gap-2 mb-4">
                <div class="flex items-center justify-center w-8 h-8 bg-green-100 rounded-lg">
                  <i class="text-lg text-green-600 pi pi-check-circle"></i>
                </div>
                <h3 class="text-lg font-semibold text-green-700 uppercase">Estados de Proceso</h3>
              </div>

              <div class="grid grid-cols-2 gap-2">
                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoTodos" inputId="estado_todos"
                    (onChange)="onEstadoProcesoChange('todos')"></p-checkbox>
                  <label for="estado_todos" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    Todos
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoEnProceso" inputId="estado_en_proceso"
                    (onChange)="onEstadoProcesoChange('en_proceso')"></p-checkbox>
                  <label for="estado_en_proceso" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    En Proceso
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoConforme" inputId="estado_conforme"
                    (onChange)="onEstadoProcesoChange('conforme')"></p-checkbox>
                  <label for="estado_conforme" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    Conforme
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoNoConforme" inputId="estado_no_conforme"
                    (onChange)="onEstadoProcesoChange('no_conforme')"></p-checkbox>
                  <label for="estado_no_conforme" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    No-Conforme
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoPendiente" inputId="estado_pendiente"
                    (onChange)="onEstadoProcesoChange('pendiente')"></p-checkbox>
                  <label for="estado_pendiente" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    Pendiente
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoAtendido" inputId="estado_atendido"
                    (onChange)="onEstadoProcesoChange('atendido')"></p-checkbox>
                  <label for="estado_atendido" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    Atendido
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoVencido" inputId="estado_vencido"
                    (onChange)="onEstadoProcesoChange('vencido')"></p-checkbox>
                  <label for="estado_vencido" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    Vencido
                  </label>
                </div>

                <div class="flex items-center">
                  <p-checkbox [binary]="true" formControlName="estadoInvalido" inputId="estado_invalido"
                    (onChange)="onEstadoProcesoChange('invalido')"></p-checkbox>
                  <label for="estado_invalido" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">
                    Inválido
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Botones de Acción -->
          <div class="flex flex-col justify-end gap-4 mt-8 border-t border-gray-200 sm:flex-row">
            <p-button icon="pi pi-search" label="Buscar" severity="info" size="small"
              (onClick)="buscarReclamaciones()" />
            <p-button icon="pi pi-times" label="Limpiar Filtros" severity="secondary" size="small"
              (onClick)="limpiarFiltros()" />
          </div>
        </form>
      </div>

      <!-- Búsqueda Rápida -->
      <div *ngIf="activeTab === 'quick'">
        <form [formGroup]="quickSearchForm">
          <div class="grid grid-cols-1 gap-6 lg:grid-cols-10">
            <!-- Panel Principal de Búsqueda -->
            <div class="p-6 space-y-4 border border-gray-200 border-solid rounded-lg shadow-sm lg:col-span-7">
              <div class="flex items-center gap-2 mb-4">
                <div class="flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg">
                  <i class="text-lg text-blue-600 pi pi-search"></i>
                </div>
                <h3 class="text-lg font-semibold text-blue-700 uppercase">Búsqueda Rápida</h3>
              </div>

              <!-- Tipo de Búsqueda -->
              <div class="space-y-4">
                <label class="block text-sm font-medium text-gray-700">Tipo de Búsqueda</label>
                <div class="flex flex-col gap-3 sm:flex-row sm:gap-6">
                  <div class="flex items-center">
                    <p-radiobutton value="dni" formControlName="searchType" inputId="dni_search"></p-radiobutton>
                    <label for="dni_search"
                      class="flex items-center gap-2 ml-3 text-sm font-medium text-gray-700 cursor-pointer">
                      <i class="text-blue-600 pi pi-user"></i>
                      DNI
                    </label>
                  </div>

                  <div class="flex items-center">
                    <p-radiobutton value="codigo" formControlName="searchType" inputId="codigo_search"></p-radiobutton>
                    <label for="codigo_search"
                      class="flex items-center gap-2 ml-3 text-sm font-medium text-gray-700 cursor-pointer">
                      <i class="text-green-600 pi pi-tag"></i>
                      Código
                    </label>
                  </div>

                  <div class="flex items-center">
                    <p-radiobutton value="nombre" formControlName="searchType" inputId="nombre_search"></p-radiobutton>
                    <label for="nombre_search"
                      class="flex items-center gap-2 ml-3 text-sm font-medium text-gray-700 cursor-pointer">
                      <i class="text-purple-600 pi pi-users"></i>
                      Nombre
                    </label>
                  </div>
                </div>
              </div>

              <!-- Campo de Búsqueda -->
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">
                  Ingrese el {{ getSearchLabel() }}
                </label>
                <div class="relative">
                  <input pInputText formControlName="searchValue" [placeholder]="getPlaceholder()"
                    class="w-full pl-10 pr-4" size="small" />
                  <i [class]="getSearchIcon(quickSearchForm.get('searchType')?.value || 'dni')"
                    class="absolute text-gray-400 transform -translate-y-1/2 left-3 top-1/2">
                  </i>
                </div>
              </div>

              <!-- Botones de Acción -->
              <div class="flex flex-col gap-3 pt-4 border-t border-gray-100 sm:flex-row">
                <p-button icon="pi pi-search" label="Buscar Ahora" severity="info" size="small"
                  [disabled]="quickSearchForm.invalid" (onClick)="buscarAhora()" />
                <p-button icon="pi pi-times" label="Limpiar" severity="secondary" size="small" (onClick)="limpiar()" />
              </div>
            </div>

            <!-- Panel de Consejos -->
            <div
              class="p-6 space-y-4 border border-gray-200 border-solid rounded-lg shadow-sm lg:col-span-3 bg-blue-50">
              <div class="flex items-center gap-2 mb-4">
                <div class="flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg">
                  <i class="text-lg text-blue-600 pi pi-lightbulb"></i>
                </div>
                <h3 class="text-lg font-semibold text-blue-700 uppercase">Consejos Útiles</h3>
              </div>

              <div class="space-y-4">
                <!-- Consejo por DNI -->
                <div class="p-3 bg-white border border-blue-200 rounded-lg"
                  *ngIf="quickSearchForm.get('searchType')?.value === 'dni' || !quickSearchForm.get('searchType')?.value">
                  <div class="flex items-start gap-2">
                    <i class="text-blue-600 pi pi-user mt-0.5"></i>
                    <div>
                      <h4 class="text-sm font-semibold text-blue-800">Búsqueda por DNI</h4>
                      <p class="mt-1 text-sm text-blue-700">
                        Ingresa el número de DNI completo (8 dígitos) sin espacios ni guiones.
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Consejo por Código -->
                <div class="p-3 bg-white border border-green-200 rounded-lg"
                  *ngIf="quickSearchForm.get('searchType')?.value === 'codigo'">
                  <div class="flex items-start gap-2">
                    <i class="text-green-600 pi pi-tag mt-0.5"></i>
                    <div>
                      <h4 class="text-sm font-semibold text-green-800">Búsqueda por Código</h4>
                      <p class="mt-1 text-sm text-green-700">
                        El código de reclamación es único y ofrece resultados más precisos.
                        Ejemplo: REC-2024-001234
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Consejo por Nombre -->
                <div class="p-3 bg-white border border-purple-200 rounded-lg"
                  *ngIf="quickSearchForm.get('searchType')?.value === 'nombre'">
                  <div class="flex items-start gap-2">
                    <i class="text-purple-600 pi pi-users mt-0.5"></i>
                    <div>
                      <h4 class="text-sm font-semibold text-purple-800">Búsqueda por Nombre</h4>
                      <p class="mt-1 text-sm text-purple-700">
                        Puedes usar nombres parciales o completos. La búsqueda no distingue
                        mayúsculas y minúsculas.
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Consejos Generales -->
                <div class="space-y-2">
                  <h4 class="text-sm font-semibold text-gray-800">📋 Recomendaciones:</h4>
                  <ul class="space-y-1 text-sm text-gray-600">
                    <li class="flex items-start gap-2">
                      <span class="flex-shrink-0 w-1 h-1 mt-2 bg-gray-400 rounded-full"></span>
                      <span>Verifica que la información esté correcta antes de buscar</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <span class="flex-shrink-0 w-1 h-1 mt-2 bg-gray-400 rounded-full"></span>
                      <span>La búsqueda por código es la más rápida y precisa</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <span class="flex-shrink-0 w-1 h-1 mt-2 bg-gray-400 rounded-full"></span>
                      <span>Si no encuentras resultados, prueba con otro tipo de búsqueda</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div> <!-- /quick -->
    </div>
  </div>

  <!-- Resultados de Búsqueda -->
  <div *ngIf="showResults" class="mt-6">
    <!-- Header de Resultados con botón Nueva Búsqueda -->
    <div class="text-white rounded-t-lg bg-[#243659]">
      <div class="flex items-center justify-between gap-3 p-4">
        <!-- Título y Subtítulo -->
        <div>
          <div class="flex items-center gap-1 uppercase">
            <i class="text-lg pi pi-list"></i>
            <h2 class="text-lg font-semibold">Resultados de Búsqueda</h2>
          </div>
          <p class="text-sm text-gray-400">
            Visualice, gestione y exporte reclamaciones de acuerdo a los filtros aplicados.
          </p>
        </div>

        <!-- Botón Nueva Búsqueda -->
        <div class="flex gap-3">
          <p-button icon="pi pi-search" label="Nueva Búsqueda" severity="secondary" size="small"
            (onClick)="nuevaBusqueda()" />

          <!-- Botón Generar Reporte -->
          <p-button icon="pi pi-file-pdf" label="Generar Reporte" severity="info" size="small"
            (onClick)="generarReporte(reclamacionSeleccionada || filteredReclamaciones[0])" />
        </div>
      </div>
    </div>

    <!-- Tabla de Reclamaciones con barra de filtro -->
    <div class="overflow-hidden bg-white border border-gray-100 shadow-lg rounded-xl">
      <!-- Header con filtros -->
      <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-slate-50 to-gray-50">
        <!-- Contenedor -->
        <div class="flex flex-col gap-4">
          <!-- Fila principal: Controles (izq) + Acciones (der) -->
          <div class="flex flex-row items-center justify-between gap-4">

            <!-- Columna izquierda: Input + Selects -->
            <div class="w-full md:max-w-5xl">
              <!-- Controles -->
              <div class="grid w-full grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Búsqueda global -->
                <label class="block">
                  <span class="block mb-1 text-xs font-medium text-gray-600">Búsqueda</span>
                  <span class="w-full p-input-icon-left">
                    <input pInputText pSize="small" type="text" [(ngModel)]="searchTerm"
                      placeholder="Código, usuario, DNI o correo"
                      class="w-full bg-white border border-gray-200 rounded-lg shadow-sm focus:border-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-100" />
                  </span>
                </label>

                <!-- Estado -->
                <label class="block">
                  <span class="block mb-1 text-xs font-medium text-gray-600">Estado</span>
                  <p-select [options]="estadoOptions" size="small" optionLabel="label" optionValue="value" [(ngModel)]="selectedEstado"
                    [showClear]="true" placeholder="Todos" (onClear)="onSelectClear('estado')"
                    class="w-full border border-gray-200 rounded-lg shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100">
                  </p-select>
                </label>

                <!-- Prioridad -->
                <label class="block">
                  <span class="block mb-1 text-xs font-medium text-gray-600">Nivel</span>
                  <p-select [options]="prioridadOptions" size="small" optionLabel="label" optionValue="value"
                    [(ngModel)]="selectedPrioridad" [showClear]="true" placeholder="Todas" (onClear)="onSelectClear('prioridad')"
                    class="w-full border border-gray-200 rounded-lg shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100">
                  </p-select>
                </label>

                <!-- Campus -->
                <label class="block">
                  <span class="block mb-1 text-xs font-medium text-gray-600">Campus</span>
                  <p-select [options]="campusOptionsTabla" size="small" optionLabel="label" optionValue="value"
                    [(ngModel)]="selectedCampus" [showClear]="true" placeholder="Todos" (onClear)="onSelectClear('campus')"
                    class="w-full border border-gray-200 rounded-lg shadow-sm focus:border-blue-500 focus:ring-4 focus:ring-blue-100">
                  </p-select>
                </label>
              </div>

              <!-- Chips de filtros activos (debajo de los controles) -->
              <div class="flex flex-wrap items-center gap-2 pt-2"
                *ngIf="searchTerm?.trim() || (selectedEstado && selectedEstado !== 'todos') || (selectedPrioridad && selectedPrioridad !== 'todos') || (selectedCampus && selectedCampus !== 'todos')">

                <ng-container *ngIf="searchTerm?.trim()">
                  <span
                    class="inline-flex items-center gap-1 rounded-full bg-blue-50 px-2.5 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-200">
                    <i class="pi pi-search text-[11px]"></i> {{ searchTerm }}
                    <button class="ml-1 text-blue-600 hover:text-blue-800" (click)="searchTerm=''">
                      <i class="pi pi-times text-[10px]"></i>
                    </button>
                  </span>
                </ng-container>

                <ng-container *ngIf="selectedEstado && selectedEstado !== 'todos'">
                  <span
                    class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-xs font-medium text-emerald-700 ring-1 ring-inset ring-emerald-200">
                    <i class="pi pi-check-circle text-[11px]"></i> {{ formatearEstadoParaTabla(selectedEstado) }}
                    <button class="ml-1 text-emerald-700 hover:text-emerald-900" (click)="selectedEstado='todos'">
                      <i class="pi pi-times text-[10px]"></i>
                    </button>
                  </span>
                </ng-container>

                <ng-container *ngIf="selectedPrioridad && selectedPrioridad !== 'todos'">
                  <span
                    class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2.5 py-1 text-xs font-medium text-amber-700 ring-1 ring-inset ring-amber-200">
                    <i class="pi pi-flag text-[11px]"></i> {{ formatearPrioridadParaDisplay(selectedPrioridad) }}
                    <button class="ml-1 text-amber-700 hover:text-amber-900" (click)="selectedPrioridad='todos'">
                      <i class="pi pi-times text-[10px]"></i>
                    </button>
                  </span>
                </ng-container>

                <ng-container *ngIf="selectedCampus && selectedCampus !== 'todos'">
                  <span
                    class="inline-flex items-center gap-1 rounded-full bg-purple-50 px-2.5 py-1 text-xs font-medium text-purple-700 ring-1 ring-inset ring-purple-200">
                    <i class="pi pi-map-marker text-[11px]"></i> {{ getCampusDisplayName(selectedCampus) }}
                    <button class="ml-1 text-purple-700 hover:text-purple-900" (click)="selectedCampus='todos'">
                      <i class="pi pi-times text-[10px]"></i>
                    </button>
                  </span>
                </ng-container>
              </div>
            </div>

            <!-- Columna derecha: Número de registros + Limpiar -->
            <div class="flex gap-3">
              <!-- Total filtrado (opcional) -->
              <span
                class="hidden md:inline-flex w-[110px] items-center justify-center px-3 py-1 text-sm font-semibold text-blue-700 rounded-full bg-blue-600/10 ring-1 ring-inset ring-blue-200">
                {{ filteredReclamaciones.length }} registros
              </span>

              <!-- Botón Limpiar -->
              <button type="button"
                class="group inline-flex items-center gap-1 rounded-lg border-solid border border-gray-200 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"
                (click)="searchTerm=''; selectedEstado='todos'; selectedPrioridad='todos'; selectedCampus='todos'">
                <i class="text-sm text-gray-500 pi pi-filter-slash group-hover:text-gray-700"></i>
                Limpiar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla -->
      <div class="overflow-x-auto">
        <p-table [value]="filteredReclamaciones" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
          currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
          [tableStyle]="{'min-width': '60rem'}">

          <!-- Header -->
          <ng-template pTemplate="header">
            <tr class="text-sm bg-gray-50/80">
              <th class="px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase">
                ID Reclamo
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-left text-gray-700 uppercase">
                Usuario
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase">
                DNI
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-left text-gray-700 uppercase">
                Correo
              </th>
              <th class="w-24 px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase">
                Tipo
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase w-36">
                Estado
              </th>
              <th class="w-32 px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase">
                Nivel
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase">
                Campus
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase w-28">
                Fecha
              </th>
              <th class="px-4 py-4 font-semibold tracking-wider text-center text-gray-700 uppercase w-36">
                Acciones
              </th>
            </tr>
          </ng-template>

          <!-- Body -->
          <ng-template pTemplate="body" let-reclamacion let-rowIndex="rowIndex">
            <tr class="transition-all duration-200 border-b border-gray-100 hover:bg-blue-50/30 group">
              <!-- ID Reclamo -->
              <td class="px-4 py-4 text-center">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-semibold bg-indigo-100 text-indigo-800 border-solid border border-indigo-200">
                  {{reclamacion.codigo}}
                </span>
              </td>

              <!-- Usuario -->
              <td class="px-4 py-4">
                <div class="flex items-center space-x-3">
                  <div class="flex items-center justify-center w-10 h-10 rounded-full shadow-sm ring-2 ring-white"
                    [ngClass]="getUserAvatarClass(reclamacion.nivel)">
                    <i class="text-sm text-white" [ngClass]="getUserIcon(reclamacion.nivel)"></i>
                  </div>
                  <div>
                    <p class="text-sm font-semibold text-gray-900">{{reclamacion.usuario}}</p>
                    <p class="text-[10px] text-center font-medium rounded-full inline-block mt-1 px-2 py-0.5 border-solid border"
                      [ngClass]="getUserBadgeClass(reclamacion.nivel)">
                      {{reclamacion.nivel}}
                    </p>
                  </div>
                </div>
              </td>

              <!-- DNI -->
              <td class="px-4 py-4 text-center">
                <span class="px-2 py-1 text-sm font-medium text-gray-700 border rounded bg-gray-50">
                  {{reclamacion.dni}}
                </span>
              </td>

              <!-- Correo -->
              <td class="px-4 py-4">
                <div class="flex items-center space-x-2">
                  <i class="text-sm text-gray-400 pi pi-envelope"></i>
                  <span class="text-sm text-gray-600 truncate max-w-[200px]" [title]="reclamacion.correo">
                    {{reclamacion.correo}}
                  </span>
                </div>
              </td>

              <!-- Tipo -->
              <td class="px-4 py-4 text-center">
                <span
                  class="inline-flex items-center px-2.5 py-1.5 text-xs font-semibold text-gray-800 bg-gradient-to-r from-gray-100 to-gray-200 rounded-lg border border-gray-300 shadow-sm">
                  <i class="mr-1 text-gray-600 pi pi-tag"></i> {{reclamacion.tipo}}
                </span>
              </td>

              <!-- Estado -->
              <td class="px-4 py-4 text-center">
                <span [class]="getEstadoClass(reclamacion.estado)"
                  class="inline-flex items-center px-2.5 py-1.5 text-sm font-semibold rounded-lg shadow-sm">
                  <span class="w-1.5 h-1.5 rounded-full mr-2" [class]="getEstadoDotClass(reclamacion.estado)"></span>
                  {{formatearEstadoParaTabla(reclamacion.estado)}}
                </span>
              </td>

              <!-- Prioridad -->
              <td class="px-4 py-4 text-center">
                <div class="space-y-2">
                  <!-- Badge principal de prioridad -->
                  <span
                    [class]="'inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-semibold shadow-xs ' + getPrioridadPorTiempoClass(reclamacion.fechaRegistro, reclamacion.estado)">
                    <i [class]="getPrioridadPorTiempoIcon(reclamacion.fechaRegistro, reclamacion.estado)"></i>
                    {{ getPrioridadPorTiempoTexto(reclamacion.fechaRegistro, reclamacion.estado) }}
                  </span>

                  <!-- Información adicional de tiempo -->
                  <div class="text-xs text-gray-500">
                    {{ getInformacionTiempo(reclamacion.fechaRegistro).mensaje }}
                  </div>

                  <!-- Barra de progreso visual opcional -->
                  <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div class="h-1.5 rounded-full transition-all duration-300"
                      [class]="getInformacionTiempo(reclamacion.fechaRegistro).dias > 15 ? 'bg-red-500' :
                                 getInformacionTiempo(reclamacion.fechaRegistro).dias >= 10 ? 'bg-yellow-500' : 'bg-green-500'"
                      [style.width.%]="getDiasWidth(getInformacionTiempo(reclamacion.fechaRegistro).dias)">
                    </div>
                  </div>
                </div>
              </td>

              <!-- Campus -->
              <td class="px-4 py-4 text-center">
                <div class="flex items-center justify-center space-x-1">
                  <i class="text-xs text-gray-500 pi pi-map-marker"></i>
                  <span class="text-sm font-medium text-gray-700">{{ getCampusDisplayName(reclamacion.campus) }}</span>
                </div>
              </td>

              <!-- Fecha -->
              <td class="px-4 py-4 text-center">
                <div class="space-y-1">
                  <div class="text-sm text-gray-500 bg-gray-100 px-2 py-0.5 rounded">
                    {{reclamacion.fechaRegistro}}
                  </div>
                </div>
              </td>

              <!-- Acciones -->
              <td class="px-4 py-4 text-center">
                <div
                  class="flex items-center justify-center gap-1 transition-opacity opacity-70 group-hover:opacity-100">
                  <button
                    class="flex items-center justify-center w-8 h-8 text-gray-600 rounded-lg hover:text-emerald-600 hover:bg-emerald-200"
                    title="Ver detalles">
                    <i class="text-[16px] pi pi-download"></i>
                  </button>

                  <button (click)="verDetalles(reclamacion)"
                    class="flex items-center justify-center w-8 h-8 text-gray-600 rounded-lg hover:text-blue-600 hover:bg-blue-200"
                    title="Ver detalles">
                    <i class="text-[16px] pi pi-eye"></i>
                  </button>

                  <button (click)="editarEstado(reclamacion)"
                    class="flex items-center justify-center w-8 h-8 text-gray-600 rounded-lg hover:text-rose-600 hover:bg-rose-200"
                    title="Cambiar estado">
                    <i class="text-[16px] pi pi-check-circle"></i>
                  </button>

                  <button (click)="asignarResponsable(reclamacion)"
                    class="flex items-center justify-center w-8 h-8 text-gray-600 rounded-lg hover:text-purple-600 hover:bg-purple-200"
                    title="Asignar responsable">
                    <i class="text-[16px] pi pi-user-plus"></i>
                  </button>

                  <button type="button" (click)="openPopover($event, reclamacion)"
                    class="flex items-center justify-center w-8 h-8 text-gray-600 rounded-lg hover:text-gray-800 hover:bg-gray-200"
                    title="Más opciones">
                    <i class="text-[16px] pi pi-ellipsis-v"></i>
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>

          <!-- Empty message -->
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="10" class="py-16">
                <div class="flex flex-col items-center justify-center space-y-4">
                  <div class="relative">
                    <div
                      class="flex items-center justify-center w-20 h-20 rounded-full shadow-lg bg-gradient-to-br from-orange-100 to-orange-200">
                      <i class="text-3xl text-orange-500 pi pi-search-minus"></i>
                    </div>
                  </div>

                  <div class="max-w-md text-center">
                    <h3 class="mb-2 text-xl font-semibold text-gray-900">
                      No se encontraron reclamaciones
                    </h3>
                    <p class="mb-6 text-sm leading-relaxed text-gray-600">
                      No hay reclamaciones que coincidan con los criterios de búsqueda aplicados.
                    </p>
                  </div>

                  <div class="flex flex-col gap-3 sm:flex-row">
                    <button type="button" (click)="nuevaBusqueda()"
                      class="inline-flex items-center px-5 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg hover:from-blue-600 hover:to-blue-700 shadow-lg">
                      <i class="mr-2 pi pi-search"></i>
                      Nueva búsqueda
                    </button>

                    <button type="button" (click)="limpiarFiltros()"
                      class="inline-flex items-center px-5 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                      <i class="mr-2 pi pi-refresh"></i>
                      Limpiar filtros
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>

<!-- Modales -->
<app-detalle [visible]="mostrarModalDetalles" [reclamacion]="reclamacionSeleccionada" (close)="cerrarModalDetalles()">
</app-detalle>

<app-estado [visible]="mostrarModalEstado" [reclamacion]="reclamacionSeleccionada" (close)="cerrarModalEstado()"
  (confirm)="onEstadoConfirm($event)">
</app-estado>

<app-responsable [visible]="mostrarModalResponsable" [reclamacion]="reclamacionSeleccionada"
  [responsables]="responsablesDisponibles" (close)="cerrarModalResponsable()" (confirm)="onAsignacionConfirm($event)">
</app-responsable>

<app-reporte [visible]="mostrarModalReporte" [reclamacion]="reclamacionSeleccionada" [tipos]="tiposReporte"
  (close)="cerrarModalReporte()" (confirm)="onReporteConfirm($event)">
</app-reporte>

<p-popover #op appendTo="body" [baseZIndex]="10000" styleClass="estatus-popover">
  <ng-template #content>
    <div class="w-64">
      <!-- Conforme -->
      <button type="button" class="item-popover" (click)="setEstatus('Conforme')">
        <p-radiobutton name="estatus" [value]="'Conforme'" [(ngModel)]="tempEstatus" inputId="estatus-conforme" />
        <label for="estatus-conforme" class="label-popover">Conforme</label>
      </button>

      <!-- Inválido -->
      <button type="button" class="item-popover" (click)="setEstatus('Inválido')">
        <p-radiobutton name="estatus" [value]="'Inválido'" [(ngModel)]="tempEstatus" inputId="estatus-invalido" />
        <label for="estatus-invalido" class="label-popover">Inválido</label>
      </button>

      <!-- No-Conforme -->
      <button type="button" class="item-popover" (click)="setEstatus('No-Conforme')">
        <p-radiobutton name="estatus" [value]="'No-Conforme'" [(ngModel)]="tempEstatus" inputId="estatus-noconforme" />
        <label for="estatus-noconforme" class="label-popover">No-Conforme</label>
      </button>
    </div>
  </ng-template>
</p-popover>